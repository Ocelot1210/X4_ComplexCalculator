<Window
    x:Class="X4_ComplexCalculator.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:wkarea="clr-namespace:X4_ComplexCalculator.Main.WorkArea"
    xmlns:x4vcvt="clr-namespace:X4_ComplexCalculator.Common.ValueConverter"
    xmlns:xcad="http://schemas.xceed.com/wpf/xaml/avalondock"
    Title="X4: ステーション計算機"
    Width="1000"
    Height="600"
    Style="{StaticResource DefaultWindowBackgroundStyle}"
    mc:Ignorable="d">

    <Window.Resources>
        <x4vcvt:ActiveDocumentConverter x:Key="ActiveDocumentConverter" />

        <XmlDataProvider x:Key="MockList" XPath="/MockObjects/*">
            <x:XData>
                <MockObjects xmlns="">
                    <MockObject Name="プリセット1" />
                    <MockObject Name="プリセット2" />
                    <MockObject Name="プリセット114514" />
                </MockObjects>
            </x:XData>
        </XmlDataProvider>
    </Window.Resources>

    <Window.InputBindings>
        <KeyBinding Command="{Binding CreateNewCommand}" Gesture="Ctrl+N" />
        <KeyBinding Command="{Binding SaveCommand}" Gesture="Ctrl+S" />
        <KeyBinding Command="{Binding SaveAsCommand}" Gesture="Shift+Ctrl+S" />
        <KeyBinding Command="{Binding OpenCommand}" Gesture="Ctrl+O" />
    </Window.InputBindings>

    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Loaded">
            <i:InvokeCommandAction Command="{Binding WindowLoadedCommand, Mode=OneTime}" />
        </i:EventTrigger>

        <i:EventTrigger EventName="Closing">
            <i:InvokeCommandAction Command="{Binding WindowClosingCommand, Mode=OneTime}" PassEventArgsToCommand="True" />
        </i:EventTrigger>
    </i:Interaction.Triggers>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--  ウィンドウ上部メニュー  -->
        <Menu Grid.Row="0">

            <!--  ファイル(F)  -->
            <MenuItem Header="ファイル(_F)">

                <!--  新規  -->
                <MenuItem
                    Command="{Binding CreateNewCommand, Mode=OneTime}"
                    Header="新規作成"
                    InputGestureText="Ctrl+N" />

                <!--  上書き保存  -->
                <MenuItem
                    Command="{Binding SaveCommand, Mode=OneTime}"
                    Header="上書き保存"
                    InputGestureText="Ctrl+S" />

                <!--  名前を付けて保存  -->
                <MenuItem
                    Command="{Binding SaveAsCommand, Mode=OneTime}"
                    Header="名前を付けて保存"
                    InputGestureText="Shift+Ctrl+S" />

                <!--  開く  -->
                <MenuItem
                    Command="{Binding OpenCommand, Mode=OneTime}"
                    Header="開く"
                    InputGestureText="Ctrl+O" />

                <!--  DB更新  -->
                <MenuItem
                    Command="{Binding UpdateDBCommand, Mode=OneTime}"
                    Header="DB更新"
                    InputGestureText="Ctrl+U" />
            </MenuItem>


            <MenuItem Header="レイアウト(_L)">
                <!--  レイアウト保存  -->
                <MenuItem Command="{Binding SaveLayout, Mode=OneTime}" Header="レイアウト保存" />

                <!--  レイアウト一覧  -->
                <MenuItem
                    Header="レイアウト一覧"
                    ItemsSource="{Binding Layouts}"
                    ToolBar.OverflowMode="Always">
                    <MenuItem.ItemContainerStyle>
                        <Style TargetType="{x:Type MenuItem}">
                            <Setter Property="MenuItem.Header" Value="{Binding LayoutName}" />
                            <Setter Property="MenuItem.IsChecked" Value="{Binding IsChecked, Mode=TwoWay}" />
                            <Setter Property="MenuItem.IsCheckable" Value="True" />
                            <Setter Property="Template" Value="{StaticResource DeleteButtonMenuItemTemplate}" />
                        </Style>
                    </MenuItem.ItemContainerStyle>
                </MenuItem>
            </MenuItem>
        </Menu>

        <!--  作業エリア  -->
        <xcad:DockingManager
            Grid.Row="1"
            ActiveContent="{Binding ActiveContent, Mode=TwoWay, Converter={StaticResource ActiveDocumentConverter}, UpdateSourceTrigger=PropertyChanged}"
            DocumentsSource="{Binding Documents}">

            <i:Interaction.Triggers>
                <i:EventTrigger EventName="DocumentClosing">
                    <i:InvokeCommandAction Command="{Binding DocumentClosingCommand, Mode=OneTime}" PassEventArgsToCommand="True" />
                </i:EventTrigger>
            </i:Interaction.Triggers>

            <xcad:DockingManager.Resources>
                <DataTemplate DataType="{x:Type wkarea:WorkAreaViewModel}">
                    <wkarea:WorkArea DataContext="{Binding}" />
                </DataTemplate>
            </xcad:DockingManager.Resources>

            <xcad:DockingManager.DocumentHeaderTemplate>
                <DataTemplate>
                    <TextBlock Text="{Binding Content.Title, Mode=OneWay, UpdateSourceTrigger=PropertyChanged}" />
                </DataTemplate>
            </xcad:DockingManager.DocumentHeaderTemplate>

            <xcad:LayoutRoot />

        </xcad:DockingManager>
    </Grid>
</Window>
